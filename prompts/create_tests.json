{
  "title": "Create tests for 'nicels' (smoke, golden, and sample invocations)",
  "role": "You are a senior C++ testing engineer experienced with CLI tools and CMake/CTesting.",
  "goals": [
    "Add smoke tests and golden-output tests that validate behavior and CLI compatibility on Linux and Windows (MSYS2 UCRT).",
    "Provide sample invocation scripts under ./test/win and ./test/lin that cover key modes (-l, -1, -C, --format, filtering, sorting, appearance, information flags).",
    "Verify a subset of outputs against GNU ls where meaningful (normalizing environment-sensitive fields); otherwise compare to golden files with fixed locale and no colors.",
    "If the project uses CMake, integrate tests with CTest; otherwise supply shell/batch scripts that return nonzero on mismatches.",
    "Optionally add a minimal CI workflow for Linux and MSYS2 ucrt64 to run the tests.",
    "Mock or isolate libgit2 interactions where deterministic outputs are required; include at least one end-to-end test with Git status enabled."
  ],
  "context": {
    "repo_state": "All changes committed. Use latest master.",
    "testing_dirs": { "windows": "./test/win", "linux": "./test/lin" },
    "platforms": ["Windows (MSYS2 UCRT)", "Linux (glibc)"],
    "compilers": {
      "windows_preferred": "clang 21.1.1 (ucrt64)",
      "linux": "clang >= 16 and/or g++ >= 12"
    }
  },
  "tests_and_validation": {
    "smoke_tests": [
      "Verify help output and exit codes (nls --help, --version).",
      "Basic directory listing with defaults; multiple paths; nonexistent path returns proper nonzero exit code.",
      "Key flags: -l, -1, -C, -x, --format=vertical,single-column,long,comma.",
      "Filtering: -a, -A, --hide PATTERN, -I PATTERN, --dirs, --files.",
      "Sorting: -t, -S, -X, -U, -r, --sort=..., --group-directories-first, --sort-files, --dots-first.",
      "Appearance: --color=never/always/auto, --no-color, --light/--dark, quoting styles, --indicator-style, -p, --hyperlink.",
      "Information: -i, -n, -s, --bytes, --block-size SIZE, -L, --gs."
    ],
    "golden_files": "Add deterministic golden outputs (no colors, fixed locale, fixed time-style) for representative directories.",
    "ci_notes": "If feasible, add a minimal GitHub Actions workflow for Linux and MSYS2 (ucrt64) that builds and runs tests."
  },
  "cli_reference_for_tests": {
    "name": "nls",
    "usage": "nls [OPTIONS] [paths...]",
    "key_flags_sample": [
      "-l","-1","-C","-x","--format","-a","-A","--hide","-I","-t","-S","-X","-U","-r","--sort",
      "--group-directories-first","--sf","--df","--color","--no-color","--light","--dark","-i","-n","-s","--bytes","--block-size","-L","--gs"
    ]
  },
  "deliverables": [
    "A tests/ directory or CTest entries registering the tests, plus golden/ with expected outputs.",
    "Scripts or notes under ./test/win and ./test/lin to demonstrate usage and to generate/compare outputs.",
    "If CMake is present: CTest integration; otherwise portable scripts that fail on mismatch.",
    "Optional: .github/workflows CI file running matrix builds (Linux + MSYS2 ucrt64)."
  ],
  "acceptance_criteria": [
    "Tests run on both Linux and Windows (MSYS2 UCRT) and catch regressions in output/exit codes.",
    "Golden tests are deterministic (fixed locale, --color=never, stable time-style).",
    "At least one test exercises Git status with a small seeded repo.",
    "Smoke tests cover help/version and a breadth of commonly used flags."
  ],
  "step_by_step_plan": [
    "Create fixtures: small directory trees with predictable metadata and a tiny Git repo for --gs.",
    "Write a normalization layer to strip environment-variant fields when comparing to GNU ls or between platforms.",
    "Add golden outputs (generated once, then reviewed/checked in).",
    "Add smoke tests for coverage of flags; register with CTest (or scripts).",
    "Wire CI (optional) to build and run tests on Linux and MSYS2 ucrt64."
  ],
  "run_examples": {
    "linux": [
      "CTEST_OUTPUT_ON_FAILURE=1 ctest -j2",
      "./test/lin/run_smoke.sh",
      "./test/lin/compare_golden.sh"
    ],
    "windows_msys2_ucrt": [
      "ctest -C Release -j2 --output-on-failure",
      ".\\test\\win\\run_smoke.bat",
      ".\\test\\win\\compare_golden.bat"
    ]
  }
}
